# MYXCROW – Deploy to Render

## Prerequisites

- Render account
- GitHub repo connected
- PostgreSQL database (Render provides this via Blueprint)

## One-Command Deploy (Blueprint)

1. In Render Dashboard: **New → Blueprint**
2. Connect this repo and select `render.yaml`
3. Render creates: PostgreSQL DB, Redis, API service, Web app
4. Set required env vars in Dashboard (see below)
5. Deploy runs automatically

## Post-Deploy: Seed Real Test Data

After first deploy, run the seed script **once** to populate test users and transactions:

```bash
# Via Render Shell (Dashboard → API service → Shell):
cd services/api && pnpm seed
```

Or from your machine (with `DATABASE_URL` from Render):

```bash
cd services/api
DATABASE_URL="postgresql://..." pnpm seed
```

**Seed users** (password: `password123`):

| Email | Role |
|-------|------|
| admin@myxcrow.com | Admin |
| buyer1@test.com | Buyer |
| seller1@test.com | Seller |
| buyer2@test.com … buyer5@test.com | Buyers |
| seller2@test.com … seller5@test.com | Sellers |

## Required Environment Variables (Render Dashboard)

Set these for the API service (sync: false = you provide the value):

| Key | Description |
|-----|-------------|
| `JWT_SECRET` | Auto-generated by Render |
| `PAYSTACK_SECRET_KEY` | From Paystack dashboard |
| `PAYSTACK_PUBLIC_KEY` | From Paystack dashboard |
| `PAYSTACK_WEBHOOK_SECRET` | From Paystack webhook config |
| `S3_ENDPOINT`, `S3_ACCESS_KEY`, `S3_SECRET_KEY` | AWS S3 or MinIO |
| `EMAIL_HOST`, `EMAIL_USER`, `EMAIL_PASS` | SMTP for emails |
| `SMS_ENABLED`, `ARKESEL_API_KEY` | For OTP (optional) |
| `WEB_APP_URL`, `WEB_BASE_URL` | Your web app URL |
| `CORS_ORIGINS` | Comma-separated allowed origins |

## Local Commands

```bash
# Install deps
pnpm install

# Build API
cd services/api && pnpm build

# Migrate + seed (requires DATABASE_URL)
cd services/api && pnpm db:setup

# Run unit tests
cd services/api && pnpm test

# Run E2E tests (requires DATABASE_URL in .env + seeded DB)
cd services/api && pnpm seed && pnpm test:e2e

# Full E2E: migrate + seed + test (set DATABASE_URL first)
cd services/api && pnpm test:e2e:full
```

## Health Check

- API readiness: `GET /api/health/readiness`
- Render uses this for health checks
